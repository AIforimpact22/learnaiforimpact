{# ------------------------ NORMAL LESSON BODY ------------------------ #}
{% set c = lesson.content or {} %}

{% if (lesson.kind or '') == 'video' %}
  {% if c.url %}
    <div class="video-frame"><video controls preload="metadata" src="{{ c.url }}"></video></div>
  {% else %}
    <div class="alert">No video URL provided.</div>
  {% endif %}
  {% if c.notes_md %}<div class="prose">{{ c.notes_md | rich }}</div>{% endif %}

{% elif (lesson.kind or '') == 'article' %}
  {% if c.body_md %}
    <div class="prose">{{ c.body_md | rich }}</div>
  {% else %}
    <p class="muted">No article content.</p>
  {% endif %}

{% elif (lesson.kind or '') == 'quiz' %}
  {% set qs = c.questions or [] %}
  {% if qs|length == 0 %}
    <p class="muted">No quiz questions yet.</p>
  {% else %}
    <div class="card quiz-wrap">
      <h3 style="margin-top:0">Quiz</h3>
      {% for q in qs %}
        {% set q_index = loop.index0 %}
        {% set qtype = q.qtype or 'single_choice' %}
        <fieldset>
          <legend>Q{{ loop.index }}.</legend>
          <div class="prose" style="margin-bottom:6px">{{ q.prompt_md | rich }}</div>
          {% if (qtype == 'single_choice') or (qtype == 'multiple_choice') %}
            {% set input_type = 'radio' if qtype == 'single_choice' else 'checkbox' %}
            {% set group_name = 'q' ~ q_index %}
            {% for opt in q.options or [] %}
              {% set opt_id = 'q' ~ q_index ~ '_opt' ~ loop.index0 %}
              <label class="choice" for="{{ opt_id }}">
                <input id="{{ opt_id }}" type="{{ input_type }}" name="{{ group_name }}{% if input_type == 'checkbox' %}[]{% endif %}" />
                <span class="opt-index">{{ 'ABCD'[:4][loop.index0] if loop.index0 < 4 else loop.index }}</span>
                <span class="prose" style="display:inline-block">{{ opt.text_md | rich }}</span>
              </label>
            {% endfor %}
          {% else %}
            <textarea rows="4" style="width:100%" placeholder="Type your answerâ€¦"></textarea>
          {% endif %}
        </fieldset>
      {% endfor %}
      <div class="quiz-note">* This quiz is for practice. Client-side scoring can be added later.</div>
    </div>
  {% endif %}

{% elif (lesson.kind or '') == 'assignment' %}
  <div class="prose">{{ (c.instructions_md or '<p>Assignment details TBA</p>') | rich }}</div>
  {% if c.resource_url %}
    <p><a class="btn ghost" href="{{ c.resource_url }}" target="_blank" rel="noopener">Open Resource</a></p>
  {% endif %}

{% else %}
  <pre><code>{{ (lesson.content or {}) | tojson(indent=2) }}</code></pre>
{% endif %}
